# üìö TMS (Transport Management System) - –°–∏—Å—Ç–µ–º–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
5. [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
6. [API Documentation](#api-documentation)
7. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
9. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
10. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
TMS (Transport Management System) - —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –æ—Ç —Å–∫–ª–∞–¥–∞ –¥–æ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- üì¶ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OMS –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
- üöö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∫–æ–º –∫—É—Ä—å–µ—Ä–æ–≤ –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- üó∫Ô∏è –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
- üìç Real-time –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫—É—Ä—å–µ—Ä–æ–≤
- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- **–ö—É—Ä—å–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:** 18
- **–¢–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:** 5 (bike, scooter, car, van, truck)
- **–°–∫–ª–∞–¥–æ–≤:** 2
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏:** 2-4 —á–∞—Å–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ real-time:** WebSocket

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã

```mermaid
graph TB
    subgraph "External Systems"
        OMS[OMS System<br/>Order Management]
        MAP[Maps API<br/>Google/Mapbox]
    end
    
    subgraph "Frontend Layer"
        WEB[Web Application<br/>React + TypeScript]
        MOBILE[Mobile App<br/>React Native]
    end
    
    subgraph "API Gateway Layer"
        GATEWAY[API Gateway<br/>:3000]
        WS[WebSocket Server<br/>Real-time updates]
    end
    
    subgraph "Microservices Layer"
        AUTH[Auth Service<br/>:3001]
        ORDER[Order Service<br/>:3002]
        COURIER[Courier Service<br/>:3003]
        VEHICLE[Vehicle Service<br/>:3004]
        ROUTE[Route Service<br/>:3005]
        LOCATION[Location Service<br/>:3006]
        ANALYTICS[Analytics Service<br/>:3007]
        NOTIFICATION[Notification Service<br/>:3008]
    end
    
    subgraph "Data Layer"
        SUPABASE[(Supabase<br/>PostgreSQL + PostGIS)]
        REDIS[(Redis<br/>Cache)]
        S3[Storage<br/>Photos/Documents]
    end
    
    %% Frontend connections
    WEB --> GATEWAY
    MOBILE --> GATEWAY
    WEB -.->|WebSocket| WS
    MOBILE -.->|WebSocket| WS
    
    %% Gateway to services
    GATEWAY --> AUTH
    GATEWAY --> ORDER
    GATEWAY --> COURIER
    GATEWAY --> VEHICLE
    GATEWAY --> ROUTE
    GATEWAY --> LOCATION
    GATEWAY --> ANALYTICS
    GATEWAY --> NOTIFICATION
    
    %% External integrations
    OMS -.->|Webhook| ORDER
    ORDER -.->|Status Update| OMS
    ROUTE --> MAP
    LOCATION --> MAP
    
    %% Services to Database
    AUTH --> SUPABASE
    ORDER --> SUPABASE
    COURIER --> SUPABASE
    VEHICLE --> SUPABASE
    ROUTE --> SUPABASE
    LOCATION --> SUPABASE
    ANALYTICS --> SUPABASE
    NOTIFICATION --> SUPABASE
    
    %% Cache connections
    AUTH --> REDIS
    ORDER --> REDIS
    LOCATION --> REDIS
    
    %% Storage
    ORDER --> S3
    COURIER --> S3
    
    style GATEWAY fill:#e1f5fe
    style SUPABASE fill:#fff3e0
    style OMS fill:#f3e5f5
    style WEB fill:#e8f5e9
    style MOBILE fill:#e8f5e9
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
   - –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫

2. **API Gateway Pattern**
   - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
   - Rate limiting –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **Event-Driven Communication**
   - WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OMS
   - Pub/Sub –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

4. **Database per Service**
   - –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### Frontend Components

#### Web Application
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** React 18, TypeScript, Redux Toolkit
- **UI Framework:** Material-UI / Ant Design
- **–ö–∞—Ä—Ç—ã:** Leaflet / Google Maps
- **Real-time:** Socket.io-client

#### Mobile Application (planned)
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** React Native
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:** iOS, Android
- **–§—É–Ω–∫—Ü–∏–∏:** GPS tracking, push notifications, offline mode

### Backend Components

#### API Gateway
- **–ü–æ—Ä—Ç:** 3000
- **–§—É–Ω–∫—Ü–∏–∏:**
  - Proxy routing –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º
  - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  - WebSocket server
  - Rate limiting
  - CORS handling
  - Request logging

#### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Ä–∞–∑–¥–µ–ª–µ [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)

---

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **–°–£–ë–î:** PostgreSQL 17.4
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:** PostGIS 3.3, uuid-ossp, pg_trgm
- **–•–æ—Å—Ç–∏–Ω–≥:** Supabase
- **Connection Pool:** Transaction Pooler

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–∞–ø–∏—Å–µ–π |
|---------|----------|---------|
| `users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–º–µ–Ω–µ–¥–∂–µ—Ä—ã) | 1 |
| `couriers` | –ö—É—Ä—å–µ—Ä—ã | 18 |
| `vehicles` | –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ | 3 |
| `stores` | –°–∫–ª–∞–¥—ã/–º–∞–≥–∞–∑–∏–Ω—ã | 2 |
| `orders` | –ó–∞–∫–∞–∑—ã –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É | Dynamic |
| `routes` | –ú–∞—Ä—à—Ä—É—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏ | Dynamic |
| `route_orders` | –°–≤—è–∑—å –∑–∞–∫–∞–∑–æ–≤ —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ | Dynamic |
| `courier_shifts` | –°–º–µ–Ω—ã –∫—É—Ä—å–µ—Ä–æ–≤ | Dynamic |
| `location_history` | –ò—Å—Ç–æ—Ä–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ | Dynamic |
| `notifications` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | Dynamic |

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã (ENUM)

```sql
-- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_role: 'admin' | 'manager' | 'dispatcher' | 'viewer'

-- –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
order_status: 'pending' | 'assigned' | 'picked_up' | 'in_transit' | 
              'delivered' | 'failed' | 'cancelled'

-- –°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
delivery_status: 'awaiting_pickup' | 'picked_up' | 'in_transit' | 
                 'delivered' | 'failed' | 'returned'

-- –°—Ç–∞—Ç—É—Å—ã –∫—É—Ä—å–µ—Ä–æ–≤
courier_status: 'available' | 'busy' | 'offline' | 'on_break'

-- –¢–∏–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
vehicle_type: 'bike' | 'scooter' | 'car' | 'van' | 'truck'
```

### –ò–Ω–¥–µ–∫—Å—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- **Spatial –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (PostGIS)
- **B-tree –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è foreign keys –∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
- **GIN –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–¢—Ä–∏–≥–≥–µ—Ä—ã** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `updated_at`

---

## üöÄ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

### 1. Auth Service (Port: 3001)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### Endpoints
```
POST /login              - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
POST /register           - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /refresh            - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /logout             - –í—ã—Ö–æ–¥
GET  /me                 - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
POST /forgot-password    - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
POST /reset-password     - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
```

#### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- JWT —Ç–æ–∫–µ–Ω—ã
- Supabase Auth
- bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 2. Order Service (Port: 3002)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OMS

#### Endpoints
```
GET  /                   - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
GET  /pending            - –ó–∞–∫–∞–∑—ã –æ–∂–∏–¥–∞—é—â–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
GET  /stats              - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
GET  /:id                - –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
POST /:id/assign         - –ù–∞–∑–Ω–∞—á–∏—Ç—å –∫—É—Ä—å–µ—Ä–∞
PUT  /:id/status         - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
PUT  /:id/delivery-status - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
POST /:id/cancel         - –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
POST /batch/assign       - –ü–∞–∫–µ—Ç–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
POST /sync               - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å OMS

Webhooks:
POST /webhook/oms        - Webhook –æ—Ç OMS
GET  /webhook/oms/health - Health check –¥–ª—è OMS
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OMS
```mermaid
sequenceDiagram
    participant OMS
    participant OrderService
    participant Database
    participant Courier
    
    OMS->>OrderService: Webhook: New Order
    OrderService->>Database: Save Order (status: pending)
    
    loop Every 5 minutes
        OrderService->>OMS: Fetch ready orders
        OMS-->>OrderService: Orders data
        OrderService->>Database: Update orders
    end
    
    Courier->>OrderService: Update delivery status
    OrderService->>Database: Update status
    OrderService->>OMS: Sync status back
    OMS-->>OrderService: Confirmation
```

---

### 3. Courier Service (Port: 3003)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞–º–∏ –∏ –∏—Ö —Å–º–µ–Ω–∞–º–∏

#### Endpoints
```
GET  /                   - –°–ø–∏—Å–æ–∫ –∫—É—Ä—å–µ—Ä–æ–≤
GET  /available          - –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—å–µ—Ä—ã
GET  /:id                - –ü—Ä–æ—Ñ–∏–ª—å –∫—É—Ä—å–µ—Ä–∞
PUT  /:id/status         - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
GET  /:id/shifts         - –°–º–µ–Ω—ã –∫—É—Ä—å–µ—Ä–∞
POST /:id/shifts         - –°–æ–∑–¥–∞—Ç—å —Å–º–µ–Ω—É
PUT  /:id/location       - –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
GET  /:id/stats          - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—É—Ä—å–µ—Ä–∞
GET  /:id/routes         - –ú–∞—Ä—à—Ä—É—Ç—ã –∫—É—Ä—å–µ—Ä–∞
```

---

### 4. Vehicle Service (Port: 3004)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏

#### Endpoints
```
GET  /                   - –°–ø–∏—Å–æ–∫ –¢–°
GET  /available          - –î–æ—Å—Ç—É–ø–Ω—ã–µ –¢–°
GET  /:id                - –î–µ—Ç–∞–ª–∏ –¢–°
PUT  /:id/status         - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
POST /:id/assign         - –ù–∞–∑–Ω–∞—á–∏—Ç—å –∫—É—Ä—å–µ—Ä—É
POST /:id/maintenance    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –¢–û
```

---

### 5. Route Service (Port: 3005)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

#### Endpoints
```
GET  /                   - –°–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤
POST /                   - –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç
GET  /:id                - –î–µ—Ç–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞
PUT  /:id/optimize       - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç
POST /:id/start          - –ù–∞—á–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç
POST /:id/complete       - –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
GET  /:id/navigation     - –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

#### –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Nearest Neighbor Algorithm
- Genetic Algorithm (planned)
- Time Window Optimization

---

### 6. Location Service (Port: 3006)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

#### Endpoints
```
POST /update             - –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
GET  /courier/:id        - –õ–æ–∫–∞—Ü–∏—è –∫—É—Ä—å–µ—Ä–∞
GET  /history/:id        - –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
POST /geofence           - –°–æ–∑–¥–∞—Ç—å –≥–µ–æ–∑–æ–Ω—É
GET  /geofence/check     - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–æ–∑–æ–Ω—É
```

---

### 7. Analytics Service (Port: 3007)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

#### Endpoints
```
GET  /dashboard          - –ú–µ—Ç—Ä–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞
GET  /reports/delivery   - –û—Ç—á–µ—Ç –ø–æ –¥–æ—Å—Ç–∞–≤–∫–∞–º
GET  /reports/courier    - –û—Ç—á–µ—Ç –ø–æ –∫—É—Ä—å–µ—Ä–∞–º
GET  /reports/performance - –û—Ç—á–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
GET  /kpi                - KPI –º–µ—Ç—Ä–∏–∫–∏
POST /export             - –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
```

---

### 8. Notification Service (Port: 3008)

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

#### Endpoints
```
POST /send               - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
GET  /user/:id           - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PUT  /:id/read           - –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
POST /broadcast          - –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
```

---

## üîå API Documentation

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º endpoints —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```http
Authorization: Bearer <token>
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
```json
{
  "data": {},
  "message": "Success",
  "timestamp": "2025-01-19T10:00:00Z"
}
```

#### –û—à–∏–±–∫–∞
```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Error description",
    "details": {}
  },
  "timestamp": "2025-01-19T10:00:00Z"
}
```

### Rate Limiting

- **–õ–∏–º–∏—Ç:** 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:**
  - `X-RateLimit-Limit`: –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤
  - `X-RateLimit-Remaining`: –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤
  - `X-RateLimit-Reset`: –í—Ä–µ–º—è —Å–±—Ä–æ—Å–∞

### WebSocket Events

#### Client ‚Üí Server
```javascript
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
socket.emit('join', { userId: '...', role: 'manager' })

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
socket.emit('location:update', {
  courierId: '...',
  lat: 55.7558,
  lng: 37.6173,
  speed: 30,
  heading: 45
})

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
socket.emit('order:statusUpdate', {
  orderId: '...',
  status: 'delivered'
})
```

#### Server ‚Üí Client
```javascript
// –õ–æ–∫–∞—Ü–∏—è –∫—É—Ä—å–µ—Ä–∞
socket.on('courier:location', (data) => {
  // { courierId, lat, lng, speed, heading }
})

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
socket.on('order:updated', (data) => {
  // { orderId, status, timestamp }
})

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
socket.on('notification', (data) => {
  // { type, title, message, severity }
})
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### OMS (Order Management System)

#### Webhook Endpoints
```
POST /api/orders/webhook/oms
```

#### Webhook Events
- `order.created` - –ù–æ–≤—ã–π –∑–∞–∫–∞–∑
- `order.updated` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `order.cancelled` - –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

#### Signature Verification
```javascript
const signature = crypto
  .createHmac('sha256', WEBHOOK_SECRET)
  .update(payload)
  .digest('hex');
```

### Maps Integration

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- Google Maps API
- Mapbox API
- OpenStreetMap (Nominatim)

#### –§—É–Ω–∫—Ü–∏–∏
- –ì–µ–æ–∫–æ–¥–∏–Ω–≥ –∞–¥—Ä–µ—Å–æ–≤
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –∏ –≤—Ä–µ–º–µ–Ω–∏
- –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. **JWT Tokens**
   - Access Token: 7 –¥–Ω–µ–π
   - Refresh Token: 30 –¥–Ω–µ–π
   - Secret rotation

2. **Role-Based Access Control (RBAC)**
   - `admin` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
   - `manager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
   - `dispatcher` - –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   - `viewer` - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä

3. **Row Level Security (RLS)**
   - –í–∫–ª—é—á–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü Supabase
   - –ü–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ user_id –∏ role

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

1. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**
   - TLS 1.3 –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - Bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
   - AES-256 –¥–ª—è sensitive data

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è**
   - Joi schemas –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - SQL injection protection
   - XSS protection (helmet.js)

3. **Rate Limiting**
   - API Gateway level
   - Per-service limits
   - DDoS protection

### –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Audit Trail**
   - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - User actions tracking
   - API calls logging

2. **Monitoring**
   - Error tracking (Sentry)
   - Performance monitoring
   - Security alerts

---

## üö¢ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/your-org/tms-backend.git
cd tms-backend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
npm run dev

# –ò–ª–∏ —Å Docker
docker-compose up -d
```

### Docker Compose Configuration

```yaml
version: '3.8'

services:
  api-gateway:
    build: ./api-gateway
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    depends_on:
      - auth-service
      - order-service
      
  auth-service:
    build: ./services/auth
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      
  order-service:
    build: ./services/order
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=production
      
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
  
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
```

### Production Deployment

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

1. **Cloud Providers**
   - AWS ECS/EKS
   - Google Cloud Run
   - Azure Container Instances

2. **PaaS Solutions**
   - Railway
   - Render
   - Fly.io

3. **Kubernetes**
   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: tms-api-gateway
   spec:
     replicas: 3
     selector:
       matchLabels:
         app: api-gateway
     template:
       metadata:
         labels:
           app: api-gateway
       spec:
         containers:
         - name: api-gateway
           image: tms/api-gateway:latest
           ports:
           - containerPort: 3000
   ```

### CI/CD Pipeline

```yaml
# .github/workflows/deploy.yml
name: Deploy TMS

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run tests
        run: npm test

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Build Docker images
        run: docker-compose build
      
  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: |
          # Deploy commands
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏

#### System Metrics
- CPU Usage
- Memory Usage
- Disk I/O
- Network I/O

#### Application Metrics
- Request Rate
- Response Time
- Error Rate
- Active Users

#### Business Metrics
- Orders per Hour
- Delivery Success Rate
- Average Delivery Time
- Courier Utilization

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

1. **Logging**
   - Winston –¥–ª—è application logs
   - ELK Stack (Elasticsearch, Logstash, Kibana)

2. **Metrics**
   - Prometheus + Grafana
   - Custom dashboards

3. **APM**
   - New Relic
   - DataDog
   - Application Insights

### Alerting

#### Critical Alerts
- Service down
- Database connection lost
- High error rate (>5%)
- Low delivery success rate (<90%)

#### Warning Alerts
- High response time (>1s)
- Memory usage >80%
- Disk space <20%
- Failed OMS sync

---

## üìà KPI –∏ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ KPI

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¢–µ–∫—É—â–µ–µ |
|---------|------------------|---------|
| Uptime | 99.9% | - |
| Response Time | <200ms | - |
| Delivery Success Rate | >95% | - |
| Average Delivery Time | <3 hours | - |
| Courier Utilization | >70% | - |

### –ë–∏–∑–Ω–µ—Å KPI

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¢–µ–∫—É—â–µ–µ |
|---------|------------------|---------|
| Orders per Day | >1000 | - |
| Cost per Delivery | <$5 | - |
| Customer Satisfaction | >4.5/5 | - |
| On-time Delivery | >90% | - |

---

## üîÑ Roadmap

### Q1 2025
- [x] –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OMS
- [x] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏
- [ ] Frontend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [ ] –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### Q2 2025
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤
- [ ] –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- [ ] Machine Learning –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ OMS

### Q3 2025
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- [ ] –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥ –ø–æ—Ä—Ç–∞–ª
- [ ] Blockchain –¥–ª—è proof of delivery

### Q4 2025
- [ ] AI-powered –¥–∏—Å–ø–µ—Ç—á–µ—Ä
- [ ] Drone delivery integration
- [ ] International expansion support
- [ ] Advanced analytics platform

---

## üë• –ö–æ–º–∞–Ω–¥–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –ö–æ–Ω—Ç–∞–∫—Ç—ã
- **Email:** support@tms-logistics.ru
- **Documentation:** https://docs.tms-logistics.ru
- **API Status:** https://status.tms-logistics.ru

### –õ–∏—Ü–µ–Ω–∑–∏—è
Proprietary Software - All Rights Reserved

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-01-19*
*–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: 1.0.0*